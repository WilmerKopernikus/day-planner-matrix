<div class="focus-areas-container">

  @if (viewMode === 'focusAreas') {
  <h1 class="page-title">Focus Areas</h1>
  } @else if (viewMode === 'subProjects' || viewMode === 'directTasks') {
  <h1 class="page-title">{{ selectedArea }}</h1>
  } @else if (viewMode === 'tasks') {
  <h1 class="page-title">{{ selectedSubProjectName() }}</h1>
  }

  @if (viewMode === 'focusAreas') {
  <div class="focus-area-buttons">
    @for (area of focusAreas(); track area) {
    <button class="task-button" type="button" [class.dragging]="area === draggingArea" (click)="selectArea(area)"
      draggable="true" (dragstart)="startDrag(area, $event)" (dragend)="endDrag()" (dragover)="handleDragOver($event)"
      (drop)="dropArea(area)">
      {{ area }}
      <span class="delete-icon" (click)="deleteFocusArea(area); $event.stopPropagation()"
        aria-label="Delete focus area">×</span>
    </button>
    }
  </div>
  }

  @if (viewMode === 'subProjects' && selectedArea) {
  <div class="navigation-row">
    <button type="button" class="link-button" (click)="goBackToFocusAreas()">← Back to Focus Areas</button>
  </div>

  <div class="focus-area-details">
    <div class="sub-projects">
      <div class="focus-area-tasks">
        @for (subProject of subProjectsForSelectedArea(); track subProject.id) {
        <div>
          <button class="task-button" type="button" [class.selected]="subProject.id === selectedSubProjectId"
            [class.dragging]="subProject.id === draggingSubProjectId" draggable="true"
            (dragstart)="startSubProjectDrag(subProject.id, $event)" (dragend)="endSubProjectDrag()"
            (dragover)="handleDragOver($event)" (drop)="dropSubProject(subProject.id)"
            (click)="selectSubProject(subProject.id)">
            {{ subProject.name }}
            <span class="delete-icon" (click)="deleteSubProject(subProject.id, $event)"
              aria-label="Delete sub-project">×</span>
          </button>
        </div>
        }
      </div>
      @if (!subProjectsForSelectedArea().length) {
      <p class="empty-state">No sub-projects yet.</p>
      }
    </div>
  </div>
  }

  @if (viewMode === 'tasks' && selectedSubProjectId) {
  <div class="navigation-row">
    <button type="button" class="link-button" (click)="goBackToSubProjects()">← Back to Sub-Projects</button>
  </div>

  <div class="sub-project-task-list">
    <div class="focus-area-tasks">
      @for (task of tasksForSelectedSubProject(); track task.id) {
      <div class="task-row">
        <button class="task-button" type="button" [class.dragging]="task.id === draggingTaskId"
          [class.selected]="task.id === selectedTaskId" draggable="true"
          (dragstart)="startTaskDrag(task.id, $event)" (dragend)="endTaskDrag()" (dragover)="handleDragOver($event)"
          (drop)="dropTask(task.id)" (click)="toggleTaskActions(task.id)">
          {{ task.name }}
          <span class="delete-icon" (click)="deleteTask(task.id); $event.stopPropagation()"
            aria-label="Delete task">×</span>
        </button>
        @if (task.id === selectedTaskId) {
        <div class="task-actions">
          <label class="visually-hidden" [attr.for]="'task-date-' + task.id">Calendar date for {{ task.name }}</label>
          <input [id]="'task-date-' + task.id" type="date" [value]="displayDateValue(task)"
            (change)="handleTaskDateChange(task.id, $event)" />
          <button class="send-button" type="button" (click)="sendTaskToCalendar(task.id)"
            [disabled]="!displayDateValue(task)">Send to calendar</button>
          <button class="complete-button" type="button" (click)="sendTaskToCalendarAndRemove(task.id)"
            [disabled]="!displayDateValue(task)">Complete & remove</button>
        </div>
        }
      </div>
      }
    </div>


  </div>
  }

  @if (viewMode === 'directTasks' && selectedArea) {
  <div class="navigation-row">
    <button type="button" class="link-button" (click)="goBackToFocusAreas()">← Back to Focus Areas</button>
  </div>

  <div class="sub-project-task-list">
    <div class="focus-area-tasks">
      @for (task of tasksForSelectedArea(); track task.id) {
      <div class="task-row">
        <button class="task-button" type="button" [class.dragging]="task.id === draggingTaskId"
          [class.selected]="task.id === selectedTaskId" draggable="true"
          (dragstart)="startTaskDrag(task.id, $event)" (dragend)="endTaskDrag()" (dragover)="handleDragOver($event)"
          (drop)="dropTask(task.id)" (click)="toggleTaskActions(task.id)">
          {{ task.name }}
          <span class="delete-icon" (click)="deleteTask(task.id); $event.stopPropagation()"
            aria-label="Delete task">×</span>
        </button>
        @if (task.id === selectedTaskId) {
        <div class="task-actions">
          <label class="visually-hidden" [attr.for]="'task-date-' + task.id">Calendar date for {{ task.name }}</label>
          <input [id]="'task-date-' + task.id" type="date" [value]="displayDateValue(task)"
            (change)="handleTaskDateChange(task.id, $event)" />
          <button class="send-button" type="button" (click)="sendTaskToCalendar(task.id)"
            [disabled]="!displayDateValue(task)">Send to calendar</button>
          <button class="complete-button" type="button" (click)="sendTaskToCalendarAndRemove(task.id)"
            [disabled]="!displayDateValue(task)">Complete & remove</button>
        </div>
        }
      </div>
      }
    </div>
    @if (!tasksForSelectedArea().length) {
    <p class="empty-state">No tasks yet.</p>
    }
  </div>
  }
</div>